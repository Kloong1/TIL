# 캐시의 기본 동작

## 캐시가 없을 때

##### 클라이언트가 star.jpg 이미지를 처음으로 요청
![](스크린샷%202022-04-26%20오후%201.52.44.png)
- 클라이언트가 star.jpg 이미지를 서버에 요청한다.
- 서버는 이미지와 헤더를 합쳐서 총 1.1M 크기의 응답 메시지를 보낸다.

##### 클라이언트가 star.jpg 이미지를 다시 요청
![](스크린샷%202022-04-26%20오후%201.54.35.png)
- 서버가 다시 1.1M 크기의 응답 메시지를 보낸다.

#### 캐시가 없으면?
- 데이터가 변경되지 않아도 계속 네트워크를 통해서 데이터를 다운로드 받아야 한다.
- 하지만 인터넷 네트워크는 매우 느리고 비싸다.
- 또 브라우저 로딩 속도가 매우 느려진다.
	- 느린 사용자 경험


## 캐시 적용

##### 서버가 star.jpg의 첫 번째 요청에 대해 캐시를 적용함
![](스크린샷%202022-04-26%20오후%201.55.41.png)
- 서버가 응답을 보낼 때, star.jpg에 대해서 캐시를 적용한다.
- `cache-control: max-age=60`
	- 60초 동안 이 캐시는 유효하다는 의미
- 첫 번째 요청이므로 일단 1.1M의 응답 메시지를 클라이언트에게 전송한다.

##### 웹 브라우저가 응답 결과를 캐시에 저장함
![](스크린샷%202022-04-26%20오후%201.59.10.png)
- `cache-control: max-age=60` 이므로 60초간 유효하다는 정보도 함께 저장한다.

##### 클라이언트의 star.jpg에 대한 두 번째 요청
![](스크린샷%202022-04-26%20오후%202.00.25.png)
![](스크린샷%202022-04-26%20오후%202.01.10.png)
- 웹 브라우저가 캐시를 먼저 확인한다.
- 캐시 유효 시간을 검증해서, 유효 시간이 지나지 않았으면 해당 캐시를 사용한다.

##### 클라이언트의 star.jpg에 대한 세 번째 요청
![](스크린샷%202022-04-26%20오후%202.02.25.png)
- 마찬가지로 웹 브라우저가 캐시를 먼저 확인한다.
- 캐시 유효 시간이 지난 경우 서버에 다시 요청을 해야한다.

#### 캐시 사용의 장점
- 캐시 덕분에 캐시 가능 시간동안 네트워크를 사용하지 않아도 된다.
- 비싼 네트워크 사용량을 줄일 수 있다.
- 브라우저 로딩 속도가 매우 빠르다.
	- 메모리 혹은 하드 디스크에서 로딩 가능하다
	- 빠른 사용자 경험

##### 캐시 유효 기간이 지났으므로 서버에 다시 star.jpg를 요청
![](스크린샷%202022-04-26%20오후%202.03.09.png)
![](스크린샷%202022-04-26%20오후%202.03.18.png)
- 캐시 유효 기간이 지났으므로 서버에 다시 star.jpg를 요청해야 한다.
- 해당 이미지에 변경이 있을 수도 있기 때문
- 첫 요청 때와 마찬가지로 서버는 1.1M의 응답 메시지를 전송한다.

#### 캐시 시간 초과
- 캐시 유효 시간이 초과하면, 서버를 통해 데이터를 다시 조회하고, 캐시를 갱신한다.
- 서버의 데이터가 변경이 있을 수 있기 때문
- 이때 다시 네트워크 다운로드가 발생한다.


#### 유효기간이 지나서 캐시가 만료가 되었음에도, 서버 데이터에 변경이 없었다면?
- 유효기간이 지나서 캐시가 만료가 되었음에도, 서버 데이터에 변경이 없었다면? 즉 클라이언트가 가지고 있는 데이터와 서버의 데이터가 캐시 만료 이후에도 여전히 동일하다면?
- 이런 상황에서 네트워크를 통해 다시 해당 데이터를 전송받는 것은 자원 낭비다.
- 이 문제를 해결하기 위해 **"검증 헤더와 조건부 요청"** 을 사용할 수 있다.