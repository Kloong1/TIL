# 타임리프 - 체크 박스 단일 선택

## 단순 HTML 체크 박스 - 타임리프 미적용
타임리프를 적용하지 않은 단순 HTML 체크 박스를 알아보자.

##### resources/templates/form/addForm.html 내용 추가
```HTML
<hr class="my-4">

<!-- single checkbox -->
<div>판매 여부</div>
<div>
	<div class="form-check">
		<input type="checkbox" id="open" name="open" class="form-check-input">
		<label for="open" class="form-check-label">판매 오픈</label>
	</div>
</div>
```

##### FormItemController.java 내용 추가
```Java
//생략
@Slf4j
public class FormItemController {
	@PostMapping("/add")
	public String addItem(@ModelAttribute Item item,
						RedirectAttributes redirectAttributes) {
		log.info("item.open={}", item.getOpen());
		Item savedItem = itemRepository.save(item);
		redirectAttributes.addAttribute("itemId", savedItem.getId());
		redirectAttributes.addAttribute("status", true);
		return "redirect:/form/items/{itemId}";
	}
	//생략...
}
```
- `@Slf4j` 어노테이션을 추가했다.
- `log.info("item.open={}", item.getOpen());`
	- `open` 이라는 파라미터 값이 잘 들어와서 `item` 객체에 저장되어있는지 출력해본다.

##### application.properties
```
logging.level.org.apache.coyote.http11=debug
```
- 모든 HTTP 요청 메시지를 로그로 출력한다.
- 폼의 입력 값이 잘 넘어오는지 확인할 수 있다.

##### 실행 결과 로그
```
FormItemController : item.open=true //체크 박스에 체크한 경우
FormItemController : item.open=null //체크 박스에 체크 안 한 경우
```
- 체크 박스에 체크하면 HTML Form에서 `open=on` 이라는 값을 넘긴다.
- Spring은 `on` 이라는 값을 boolean 타입인 `true` 값으로 변환해준다.
	- Spring의 타입 컨버터가 이 기능을 수행한다. 자세한 내용은 뒤에서 설명한다.

##### 체크 여부에 따른 HTTP 요청 메시지 바디
```
itemName=asd&price=123&quantity=1&open=on] //체크 박스에 체크한 경우

itemName=asd&price=123&quantity=1] //체크 박스에 체크 안 한 경우
```
- **체크하지 않은 경우 아예 `open` 파라미터가 존재하지 않는다!**

#### 주의! - 순수 HTML 체크 박스에서 체크를 하지 않는 경우
- 순수 HTML Form에서 체크 박스에 체크를 하지 않고 입력 값을 전송하면, 아예 해당 파라미터가 넘어가지 않는다!
- 즉 여기서는 `open` 이라는 파라미터 자체가 서버로 전송되지 않는다!
- 그래서 `item.open=null` 이 출력되는 것이다.
- 상황에 따라서 이 방식이 문제가 될 수 있다.
	- 처음부터 체크가 되어있는 체크박스가 있다고 하자.
	- 사용자가 의도적으로 체크를 해제해도, 폼 입력값 전송 시 해당 체크박스에 대한 값이 아예 넘어가지 않는다.
	- 따라서 서버는 값이 넘어오지 않는 경우를 감지하고, 체크 해제에 대한 올바른 동작을 추가로 처리해주어야 한다. 그렇지 않으면 값이 변경되지 않을 것이다.
- 우리가 원하는 것은 `open=off` 라던가 `open=false` 같이 체크를 하지 않았다는 사실을 명확히 알 수 있는 어떤 값이 넘어오는 것이다.
	- 그렇게 되면 다른 로직을 추가하지 않고 단순히 값을 덮어 씌우는 것으로 해결이 가능해진다.


### 해결 방법 - Spring MVC의 히든 필드
```HTML
<input type="checkbox" id="open" name="open" class="form-check-input">
<input type="hidden" name="_open" value="on" />
```
- 이런 문제를 해결하기 위해서 스프링 MVC는 히든 필드를 사용하는 방법을 제공한다.
- `name=_open` 처럼 원하는 체크 박스의 `name` 속성 값 앞에 언더스코어( _ )를 붙인 히든 필드를 만든다.
- 히든 필드는 화면에 보이진 않지만, 값이 항상 전송된다.
- 따라서 체크 박스의 체크를 해제한 경우 `open=on` 은 전송되지 않고, `_open=on` 만 전송되는데, 이 경우 스프링 MVC는 체크를 해제했다고 판단한다.

##### 체크 여부에 따른 HTTP 요청 메시지 바디
```
itemName=asd&price=123&quantity=1&open=on&_open=on] //체크 박스에 체크한 경우

itemName=asd&price=123&quantity=1&_open=on] //체크 박스에 체크 안 한 경우
```
- `open=on&_open=on`
	- 체크 박스에 체크하면 스프링 MVC가 `open` 파라미터 값이 존재하는 것을 확인하고 사용한다.
	- 이때 `_open` 은 무시한다.
- `_open=on`
	- 체크 박스를 체크하지 않으면 스프링 MVC가 `_open` 파라미터만 있는 것을 확인한다. 이 때 스프링 MVC는 체크 박스가 체크되지 않았다고 인식한다.
	- 이 경우 서버에서 해당 값을 찍어보면 `null` 이 아니라 `false` 가 정상적으로 출력되는 것을 확인할 수 있다.

## 체크 박스 - 타임리프 적용
