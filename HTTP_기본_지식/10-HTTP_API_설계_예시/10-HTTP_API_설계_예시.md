# HTTP API 설계 예시
HTTP 설계 예시를 살펴보자.

또 예시를 통해 POST를 사용한 등록과 PUT을 사용한 등록이 어떤 차이가 있는지도 살펴보자.

마지막으로 GET과 POST만 사용 가능하다는 제약이 있는 HTTP Form 환경에서 HTTP API를 어떻게 설계할 수 있는지 알아보자.

## 회원 관리 시스템 HTTP API 설계
![](스크린샷%202022-04-19%20오후%2011.28.18.png)

**URI는 리소스를 식별해야 한다! 동작/행위는 HTTP 메서드를 이용하자.**

### 회원 목록 조회
- 예시: `GET /members`
- 쿼리 파라미터를 추가해서 필터링 및 정렬도 가능하다.

### 회원 등록
- 예시: `POST /members`
- `/members` 이런 것을 컬렉션이라고 한다. 컬렉션에 데이터를 등록한다는 것이다.
- 회원의 정보는 메시지 바디에 넣으면 된다.

### 특정 회원 조회
- 예시: `GET /members/100`
- URI의 계층 구조를 이용해서 회원 id를 URI로 표현한다.
- id에 해당하는 회원을 조회한다.

### 회원 수정
- 예시: `PATCH /members/100`, `PUT /members/100`
- PATCH, PUT, POST의 메서드 전부 사용 가능하다.
- 개념적으로 리소스의 일부를 수정하는 메서드인 PATCH를 쓰는 것이 가장 좋다.
	- PUT은 데이터를 완전히 덮어쓰기 때문에, 데이터의 일부가 소실될 위험성을 내재한다.
	- 게시판의 게시글을 수정할 때는, 수정한 게시글의 모든 내용을 전부 서버로 보내기 때문에 PUT을 사용하기 쉽다.
	- 이도 저도 애매하면 POST를 쓰면 된다.

### 회원 삭제
- 예시: `DELETE /members/100`
- URI의 계층 구조를 이용해서 회원 id를 URI로 표현한다.
- id에 해당하는 회원을 삭제한다.


## POST 신규 자원 등록 특징
- POST로 등록하는 경우, 클라이언트는 등록될 리소스의 URI를 모른다.
	- `POST /members` -> URI에 등록될 리소스의 URI에 대한 정보가 전혀 없다.
- 서버가 알아서 새로 등록된 리소스의 URI를 결정한다.
	- 응답 메시지를 보면 `Location: /members/100` 이런 헤더를 볼 수 있을 것이다. 이 URI가 새로 등록된 리소스의 URI이다.
- 이런 형식을 **컬렉션**이라고 한다.
	- 컬렉션: 서버가 관리하는 리소스 디렉토리
	- 서버가 리소스의 URI를 생성하고 관리
	- 이 예제에서 컬렉션은 `/members`


## PUT 신규 자원 등록 특징
##### PUT 기반 등록 예시 - 파일 관리 시스템
![](스크린샷%202022-04-20%20오후%2010.48.31.png)

클라이언트에서 원격 서버에 파일을 등록하고 조회하는 시스템이다.

파일 목록, 조회, 삭제는 위에서 언급한 회원 목록, 조회, 삭제와 동일한 방식으로 이루어진다. id 대신 filename을 사용하는 정도의 차이가 있을 뿐이다.

하지만 파일 등록은 회원 등록과 다른 점이 있다.

### 파일 등록
- 예시: `PUT /files/test.txt`
- **클라이언트가 등록될 파일의 URI를 이미 알고있어야 한다!**
	- 클라이언트가 직접 등록할 리소스의 URI를 지정한다.
	- 따라서 PUT을 쓸 수 있다.
	- 없으면 대체하고, 있으면 새롭게 생성한다.
- POST 기반의 회원 등록의 경우 클라이언트는 등록될 회원의 id를 알지 못하지만 (등록될 리소스의 URI를 모르지만) , PUT 기반의 파일 등록의 경우 클라이언트가 URI를 이미 알고 지정해준다.
- POST 기반의 등록에서는 서버가 리소스의 URI를 알아서 지정해주지만, PUT 기반의 등록에서는 클라이언트가 리소스의 URI를 직접 지정하고 관리한다.
- 이런 형식을 **스토어**라고 한다.
	- 스토어: 클라이언트가 관리하는 리소스 저장소
	- 클라이언트가 리소스의 URI를 알고 관리
	- 이 예제에서 스토어는 `/files`
- PUT으로 파일 등록을 하고 있기 때문에, POST 메서드의 의미를 임의로 지정할 수 있다.
	- 이 예시에서는 `POST /files` 로 여러 파일을 한 번에 등록하는 요청을 할 수 있게 설계했다.


## POST 기반 등록 VS PUT 기반 등록
실무에서는 대부분 POST 기반 등록(컬렉션) 을 사용한다. 


## HTML Form 사용 등록
- **HTML Form은 GET, POST만 지원한다.**
	- 실제로는 AJAX 같은 기술을 사용해서 API 통신이 가능하지만, 여기서는 순수 HTML만 사용한다고 가정한다.
- GET, POST만 지원하는 환경이므로 제약이 있다.

##### HTML Form을 사용한 회원 관리 API 설계
![](스크린샷%202022-04-20%20오후%2011.01.39.png)

HTML 환경에서 이루어지는 상황을 가정한 설계이기 때문에, HTML 페이지가 주어지고 거기서 사용자가 어떤 동작을 했을 때 웹 브라우저가 그 동작에 맞는 요청을 보내는 상황을 상상하면 된다.

예를 들어 첫 화면에서 "회원 등록" 버튼을 누르면 "회원 등록 폼"이 있는 페이지로 이동하는 방식이다.

회원 목록, 회원 조회는 위에서 언급한 예제와 크게 다른 부분이 없으므로 자세한 설명은 생략한다.

### 회원 등록
- "회원 등록" 버튼을 누르면 `GET /members/new` 요청이 서버로 전송된다.
- 서버는 "회원 등록 폼"이 있는 HTML 파일을 HTTP 메시지 바디에 담아 클라이언트에게 응답 메시지로 보낸다.
- 클라이언트의 웹 브라우저는 해당 페이지를 렌더링한다.
- 사용자가 회원 등록 폼에 회원의 정보를 기입한 뒤, HTML Form의 submit 버튼을 누른다.
- 웹 브라우저가 폼에 담긴 정보로 HTTP 요청 메시지를 만든다.
	- Request-line은 `POST /members/new` 이다.
	- 바디에 폼에 기입한 회원 정보가 적절히 인코딩되어서 들어있다.
	- `POST /members` 이렇게 해도 된다. 선택 사항이라고 한다.

### 회원 수정
- 회원 조회를 해서 id가 100인 회원의 상세 정보 페이지가 웹 브라우저에 표시되고 있다고 하자.
- 이 상황에서 "회원 수정" 버튼을 누르면 `GET /members/100/edit` 요청을 보낸다.
- 서버는 "회원 수정 폼"이 있는 HTML 파일을 HTTP 메시지 바디에 담아 클라이언트에게 응답 메시지로 보낸다.
- 나머지는 회원 등록과 동일하다.

### 회원 삭제
- HTML Form에서는 DELETE 메서드를 쓸 수 없다.
	- `DELETE /members/100` 하면 id가 100인 회원을 지우라는 요청을 서버로 보낼 수 있는데, HTML Form에서는 불가능하다.
- 애매할 때, 혹은 어쩔 수 없을 때는 POST를 쓰면 된다.
- `POST /members/100/delete`
	- URI에 delete라는 행위가 들어있다.
	- 어쩔 수 없다. DELETE를 쓸 수 없기 때문에 POST와 함께 컨트롤 URI를 사용해야 한다.

### HTML Form 정리
- HTML Form은 **GET, POST만 지원한다**.
- **컨트롤 URI의 사용이 강제된다.**
	- 리소스 식별에 추가로 행위의 의미를 더한 URI를 사용해야 한다.
	- `POST /members/new`, `POST /members/{id}/edit`, `POST /members/{id}/delete` 가 컨트롤 URI다. URI에 동작에 대한 의미가 들어있다.
	- HTTP 메서드만 사용해서 해결이 어려운 경우에 사용한다.
		- 실무에서는 많이 사용한다.
		- 하지만 막 사용해서는 안된다. 최대한 URI는 리소스 식별에 집중하고, 어쩔 수 없는 상황에서만 사용해야 한다.


## 정리
- HTTP API - 컬렉션
	- POST 기반 등록
	- 서버가 리소스 URI 결정
- HTTP API - 스토어
	- PUT 기반 등록
	- 클라이언트가 리소스 URI 결정
- HTML FORM 사용
	- 순수 HTML + HTML form 사용
	- GET, POST만 지원

### 참고하면 좋은 URI 설계 개념
https://restfulapi.net/resource-naming 를 참고하면 좋다.

- **문서(document)**
	- 단일 개념(파일 하나, 객체 인스턴스, 데이터베이스 row)
	- 예) /members/100, /files/star.jpg
- **컬렉션(collection)**
	- 서버가 관리하는 리소스 디렉터리
	- 서버가 리소스의 URI를 생성하고 관리
	- 예) /members
- **스토어(store)**
	- 클라이언트가 관리하는 자원 저장소
	- 클라이언트가 리소스의 URI를 알고 관리
	- 예) /files
- **컨트롤러(controller), 컨트롤 URI**
	- 문서, 컬렉션, 스토어로 해결하기 어려운 추가 프로세스 실행
	- 동사를 직접 사용
	- 예) /members/{id}/delete